# 8. 게이트웨이, 터널, 릴레이

게이트웨이 : 서로 다른 프로토콜과 애플리케이션 간의 HTTP 인터페이스

애플리케이션 인터페이스 : 서로 다른 형식의 웹 애플리케이션이 통신하는데 사용된다.

터널 : HTTP 커넥션을 통해서 HTTP가 아닌 트래픽을 전송하는 데 사용한다.

릴레이 : 일종의 단순한 HTTP 프록시로, 한 번에 한 개의 홉에 데이터를 전달하는데 사용한다.

## 1. 게이트 웨이

리소스와 애플리케이션을 연결하는 역할을 한다.

- HTTP 트래픽을 다른 프로토콜로 자동으로 변환하여 서버에 접속할 수 있게 한다.

### 서버 측 게이트웨이와 클라이언트 측 게이트 웨이

웹 게이트웨이는 한쪽은 HTTP, 반대편은 다른 프로토콜을 사용한다. (ex. HTTP/FTP 게이트 웨이)

- 게이트웨이에 해당 서버 인증서가 설치되어 이어야 한다.
- HTTP 버전이 다른경우에도 사용되는데 이는 프록시로 불린다.

## 2. 프로토콜 게이트 웨이

프록시와 같이 HTTP 트래픽을 거치도록 할 수 있다.

즉 특정 프로토콜을 포함한 요청만 게이트웨이를 통과하게 한다.

### 서버 측 게이트웨이

서버측 게이트웨이는 클라이언트로부터 HTTP 요청이 원 서버 영역으로 들어오는 시점부터 프로토콜을 변환한다.

- 접속할 (리소스)서버에 로그인
- CWD 명령, 다운로드 형식 변경, 최근 수정 시간 등등
- 데이터 및 객체 검색
- 접속할 (리소스)서버에 데이터 커넥션 생성 및 객체 전송

서버 측 보안 게이트웨이 → HTTP/HTTPS 게이트 웨이로 보안을 제공할 수 있다.

클라이언트 측 보안 가속 게이트웨이 → HTTPS/HTTP 게이트웨이로 보안없이 빠른 요청을 주고 받는다.

## 3. 리소스 게이트웨이

게이트웨이의 가장 일반적인 형태는 목적지 서버와 게이트웨이를 한 개의 서버로 결합하는 것이다.

동작 방식은 애플리케이션 프로그래밍 인터페이스를 통해 요청을 서버 내 애플리케이션에게 전달한다. (CGI)

### CGI

최초의 서버 확장이자 지금까지 가장 널리 쓰이는 서버 확장

- CGI는 내부에서 어떻게 동작하는지 사용자가 볼 수 없다.
- 사용자는 일반적인 요청을 만드는거로 보인다.
- 모든 요청마다 CGI는 새로운 프로세스를 만들어 이는 부하가 크다.

### 서버 확장 API

CGI의 아쉬운 성능, 서버 동작 제어를 위해선 서버마다 활용할 수 있는 서버 확장 API를 만드는 것이 좋다.

서버 확장 API는 서버마다 상이한 아키텍처에 의존하기 때문에 개발자가 유용하게 사용할 수 있다.

## 4. 애플리케이션 인터페이스와 웹 서비스

애플리케이션이 상호작용할 때 각 프로토콜이 다른데, 이는 표준 프로토콜 위에서 동작한다.

## 5. 터널

터널 : HTTP 프로토콜을 지원하지 않는 애플리케이션에 HTTP로 접근하도록 도와주는 기술

### **CONNECT로 터널 커넥션 맺기**

CONNECT 메서드는 터널 게이트웨이가 임의 목적 서버와 포트에 TCP 커넥션을 맺고 클라이언트-서버 간 데이터를 전달한다.

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/85796588/9f6852cb-d102-4333-a1f6-8ef3a781de0a)



- 클라이언트에서 게이트웨이 터널을 위해 CONNECT 요청 (TCP)
- 터널은 서버와 TCP 커넥션을 생성한다.
- 터널이 생성되면 클라이언트에게 200 Connection Established를반환한다.
- 터널이 연결되어 서버와 클라이언트 사이의 데이터는 HTTP 터널을 통해 전달된다.

* CONNECT 요청 : 시작줄을 제외하고 다른 HTTP 메서드와 같다. (요청 URI를 목적지의 URI로 적음)

* CONNECT 응답 : 200 Connection Established

### 데이터 터널링, 시간, 커넥션 관리

터널을 통해 전달되는 데이터는 게이트웨이에서 볼 수 없다. 따라서 패킷의 순서나 흐름 또한 알 수 없다.

터널의 커넥션이 끊어지면, 거기서 온 데이터는 반대편으로 전달되며 그 반대편도 커넥션이 끊긴다.

### SSL 터널링

터널링의 개발이유는 방화벽에 SSL 트래픽을 전달하기 위함이다.

80포트만 허용하는 프록시 방화벽에 접근하기 위해 포트를 변경하고자 생긴 것이다.

### HTTP/HTTPS 게이트 웨이

원격 HTTPS 서버와 SSL 게이트웨이를 두고, 클라이언트의 요청을 처리하는 방식이다.

클라이언트와 게이트웨이 사이엔 보안이 적용되지 않은 HTTP가 존재하며, 게이트웨이는 SSL을 완벽히 지원해야 한다.

### 터널 인증

CONNECT 요청을 보낼 때 게이트웨이는 인증을 요구한다.

적절한 인증이 이루어지면 서버와 게이트웨이 사이에 TCP 커넥션이 생성된다.

## 6. 릴레이

릴레이 : HTTP 명세를 완전히 준수하지 않는 간단한 HTTP 프록시이다. 맹목적으로 트래픽을 전달하기 위해 사용된다.

단순히 데이터 전달, 단순 필터링, 콘텐츠 변환에 사용된다. (상호 운용문제 야기, keep-alive 등)

이런 문제 때문에 릴레이는 신중히 사용해야 하며, HTTP 명세를 준수하는 프록시를 사용하는게 좋다.
