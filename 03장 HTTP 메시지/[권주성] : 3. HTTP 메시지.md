# 3장. HTTP 메시지

## 3.1 메시지의 흐름
- HTTP 메세지는 애플리케이션 간에 주고받은 데이터의 블록들
  - 메시지의 내용과 의미를 설명하는 텍스트 메타 정보와 선택적으로 데이터가 올 수 있음

### 3.1.1메시지는 원 서버 방향을 인바운드로 하여 송신된다
- 메시지가 원 서버로 향하는 것은 인바운드로 이동하는 것이고, 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드
  
  ![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/76086137-de87-4393-aa6f-58ade3cc5594)

### 3.1.2 다운스트림으로 흐르는 메세지
- 모든 메세지는 다운스트림으로 흐름 → 메시지의 발송자는 수신자의 업스트림

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/bd7a8824-01b5-4f8d-8580-875be826fcbe)


## 3.2 메시지의 각 부분
- 각 메세지는 시작줄, 헤더 블록, 본문 세 부분으로 이루어짐
- 시작줄은 어떤 메시지인지 서술하며, 헤더 블록은 속성, 본문은 데이터를 담고있음

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/f8618d1b-f162-4555-9563-23e84b0ddc6b)


### 3.2.1 메시지 문법
- 메시지는 요청 메시지와 응답 메시지로 나누어짐

- 요청 메시지 형식

  ![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/c03602d6-0cc5-4fa5-adcf-633a2bc5985e)

- 응답 메시지 형식

  ![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/52eb4231-83e0-4155-8bea-7cc1d3bfa8ae)


- 메서드: 서버가 리소스에 대해 수행해주길 바라는 동작
- 요청 URL: 요청 대상이 되는 리소스를 지칭하는 URL
- 버전: 메시지에서 사용하는 HTTP 버전
- 상태코드: 성공, 에러등을 나타내는 세 자리의 숫자
- 사유 구절: 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 문구
- 헤더들: 이름, 콜론, 선택적인 공백, 값, CRLF 가 순서대로 나타나는 0 개 이상의 헤더들
- 엔터티 본문: 데이터 블록을 포함한다.

### 3.2.2 시작줄
- 메세지의 시작줄은 무엇을 해야 하는지 말해줌

- 요청줄: 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 동작에 대한 대상을 지칭하는 요청 URL 이 들어있음
- 응답줄: 응답 메시지에서 쓰인 HTTP 의 버전, 숫자로 된 상태 코드, 수행 상태에 대해 설명해주는 텍스트 사유구절
- 메서드: 서버에게 무엇을 해야하는지 말해줌
- 상태코드: 클라이언트에게 무엇이 일어났는지 말해줌 (100 - 정보, 200 - 성공, 300 - 리다이렉션, 400 - 클라이언트 에러, 500 - 서버에러)
- 사유구절: 상태 코드에 대한 글로 된 설명을 제공
- 버전 번호: 응답, 요청 메세지 모두에 기술됨. 자신이 따르는 프로토콜 버전을 상대방에게 말해주기 위한 수단

### 3.2.3 헤더
- 헤더 필드는 요청과 응답 메시지에 추가 정보를 더한 내용

- 일반 헤더: 요청과 응답 양쪽에 모두 나타낼 수 있음
- 요청 헤더: 요청에 대한 부가 정보를 제공
- 응답 헤더: 응답에 대한 부가 정보를 제공
- Entity 헤더: 본문 크기와 콘텐츠, 리소스 그 자체를 서술
- 확장 헤더: 명세에 정의되지 않은 새로운 헤더

### 3.2.4 엔터티 본문
- HTTP 메세지는 이미지, 비디오, HTML 문서 등 여러 종류의 디지털 데이터를 실어 나를 수 있음

## 3.3 메서드

### 3.3.1 안전한 메서드
- GET, HEAD 메서드는 안전한 메서드
  - 이는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미

### 3.3.2 GET
- 서버에게 리소스를 달라고 요청하기 위해 쓰임

### 3.3.3. HEAD
- GET 처럼 행동하지만, 서버는 응답으로 헤더만 돌려줌

- 응답의 상태 코드를 통해, 개체의 존재 유무를 알 수 있음
  = 리소스가 변경되었는지 검사 할 수 있음

### 3.3.4 PUT
- 서버가 요청의 본문을 가지고 요청 URL 의 이름대로 새 문서를 만들거나, 이미 URL 이 존재한다면 본문을 사용해서 교체하는 것

### 3.3.5 POST
- 서버에 입력 데이터를 전송하기 위해 설계

### 3.3.6 TRACE
- 클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려줌
  - 주로 진단을 위해서 사용

### 3.3.7 OPTIONS
- 웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어봄

- 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있음

### 3.3.8 DELETE
- 서버에게 요청 URL 로 지정한 리소스를 삭제할 것을 요청

## 3.4 상태 코드

### 3.4.1 100-109: 정보성 상태 코드

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/e2db55c1-580a-43b4-b8d7-e6acf643674d)

#### 100(Continue)
- 클라이언트는 나머지를 계속이어서 보내야 함을 의미

- 100-Continue 는 최적화를 위한 것
  - 클라이언트 애플리케이션은 100-Continue 를 서버가 다루거나 사용할 수 없는 큰 엔터티를 서버에게 보내지 않으려는 목적으로만 사용
  
- 프락시가 다음 홉 서버들에 대한 상태 몇 가지와 그들이 지원하는 HTTP 버전을 기억해둔다면, 100-continue 응답을 기대한 요청을 더 잘 다룰 수 있게 되므로 프락시에게 이득이 됨

#### 101(Switching Protocols)
- 클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음을 의미한다.

### 3.4.2 200-299: 성공 상태 코드

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/33b66c76-2863-498b-aa6a-d02a6d732c54)

### 3.4.3 300-399: 리다이렉션 상태 코드

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/042e7965-8018-4db7-a70e-c030919930ec)

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/3cb0fbab-2990-4c00-820d-9851e745b0b1)

### 3.4.4 400-499: 클라이언트 에러 상태 코드

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/471713e0-c55d-4ef3-84b5-bc9f0dc8dc26)

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/5771d405-2ea1-4a19-8cf4-2bc7f2afb781)

### 3.4.5 500-599: 서버 에러 상태 코드

![image](https://github.com/Deep-Dive-Study/http-perfect-guide/assets/99165624/0346b876-da5f-4671-b3e9-99ff60600642)

## 3.5 헤더
- 헤더와 메서드는 클라이언트와 서버가 무엇을 하는지 결정하기 위해서 사용됨

- 일반헤더: 서버, 클라이언트 양쪽에서 사용, 메시지를 보내는 다른 애플리케이션들을 위해 다양한 목적으로 사용
- 요청 헤더: 요청 메시지를 위한 헤더, 서버에게 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 정보를 제공
- 응답 헤더: 응답 메세지는 클라이언트에게 정보를 제공하기 위한 자신만의 헤더를 가지고 있음
- 엔터티 헤더: 본문에 대한 헤더를 말한다. 본문에 들어있는 데이터의 타입이 무서인지 말해줄 수 있음
- 확장 헤더: 비표준 헤더다.

### 3.51 일반 헤더
- 메시지에 대한 아주 기본적인 정보를 제공

- connection: 클라이언트와 서버가 요청/응답 연결에 대한 옵션을 정할 수 있게 해줌
- date\*: 메시지가 언제 만들어졌는지에 대한 날짜와 시간을 제공
- mime-version: 발송자가 사용한 mime 의 버전을 알려줌
- trailer chunked transfer: 인코딩으로 인코딩된 메시지의 끝 부분에 위치한 헤더들의 목록을 나열함
- trasfer-encoding: 전송을 위해 어떤 인코딩이 적용되었는지 말해줌
- upgrade: 새 버전이나 프로토콜을 알려줌
- via: 어떤 중개자로부터 왔는지 알려줌

#### 일반 캐시 헤더
- cache-control: 메시지와 함께 캐시 지시자를 전달하기 위해 사용
- pragma: 메시지와 함꼐 지시자를 전달하는 또 다른 방법. 캐시에 국한되지 않음

### 3.5.2 요청 헤더
- 요청 메시지에서만 의미를 갖는 헤더
  - 최초 발생한곳에서 누가 혹은 무엇이 그 요청을 보냈는지, 클라이언트의 선호나 능력에 대한 정보를 줌

- client-ip, from, host, referer, os, user agent 등 ...

#### accept 관련 헤더
- 서버에게 자신의 선호와 능력을 알려 줄 수 있음
- 서버는 이 정보를 활용해서 무엇을 보낼 것인가에 대한 처리를 할 수 있음

- accept: 보내도 되는 미디어의 종류
- accept - charset, encoding, language, te: 보내도되는 문자집합, 인코딩, 언어, 전송코딩

#### 조건부 요청 헤더
- 요청에 몇몇 제약을 넣을 수 있다.

- expect: 요청에 필요한 서버의 행동을 열거
- if-match: 문서의 엔터티 태그가 주어진 엔터티 태그와 일치하는 경우에만 문서를 가져옴
- if-modified-since: 주어진 날짜 이후에 리소스가 변경되지 않았다면 요청을 제한
- if-none-match: 문서의 엔터티 태그가 주어진 엔터티 태그와 일치하지 않는 경우에만 문서를 가져옴
- if-range: 특정 범위에 대한 요청을 할 수 있게 해줌
- if-unmodified-since: 주어진 날짜 이후에 리소스가 변경되었다면 요청을 제한
- range: 특정 범위에 대한 요청

#### 요청 보안 헤더
- HTTP는 자체적으로 요청을 위한 간단한 인증요구/응답 체계를 갖고 있음

- authorization: 클라이언트가 서버에게 제공하는 인증 그 자체에 대한 정보를 담고있음
- cookie: 클라이언트가 서버에게 토큰을 전달할 때 사용
- cookie2: 요청자가 지원하는 쿠키의 버전을 알려줄 때 사용

#### 프락시 요청 헤더
- 프락시의 기능을 돕기 위해 몇몇 헤더들이 정의되어 있음

- max-forwards: 프락시나 게이트웨이로 전달될 수 있는 최대 횟수
- proxy-authorization: 프락시에서 인증을 할 때 쓰임
- proxy-connect: 프락시에서 연결을 맺을 때 쓰임

### 3.5.3 응답 헤더
- 클라이언트에게 부가 정보를 제공

- age: 응답이 얼마나 오래되었는지
- public: 특정 리소스에 대해 지원하는 요청 메서드의 목록
- retry-after: 현재 리소스가 사용불가일때 언제 가능해지는지 날짜 혹은 시각
- server: 서버 애플리케이션의 이름과 버전
- title: html 문서에서 주어진 것과 같은 제목
- warning: 사유 구절에 있는 것보다 더 자세한 경고 메세지

#### 협상 헤더
- 서버가 협상 가능한 리소스에 대한 정보를 운반하는 몇 가지 헤더들

- accept-ranges: 범위의 형태
- vary: 응답에 영향을 줄 수 있는 헤더들의 목록

#### 응답 보안 헤더
- 인증요구 헤더

- proxy-authenticate: 프락시에서 클라이언트로 보낸 인증요구의 목록
- set-cookie: 서버가 클라이언트를 인증할 수 있도록 클라이언트 측에 토큰을 설정하기 위해 사용
- www-authenticate: 서버에서 클라이언트로 보낸 인증요구의 목록

### 3.5.4 엔터티 헤더
- 엔터티와 그것의 내용물에 대한, 개체의 타입부터 시작해서 주어진 리소스에 대해 요청 할 수 있는 유요한 메서드들까지 광범위한 정보를 제공

- allow: 수행될 수 있는 요청 메서드들을 나열
- location: 클라이언트에게 엔터티가 실제로 어디에 위치하고 있는지 말해줌

#### 콘텐츠헤더
- 엔터티의 콘텐츠에 대한 구체적인 정보를 제공

- content-base: 기저 url
- content-encoding: 적용된 인코딩
- content-language: 적절한 언어
- content-length: 본문의 길이나 크기
- content-location: 리소스의 위치
- content-md5: md5 체크섬
- content-range: 범위를 바이트 단위로 표현
- content-type: 어떤 종류의 객체인지

#### 엔터티 캐싱 헤더
- 언제 어떻게 캐시가 되어야 하는지에 대한 지시자를 제공

- etag: 엔터티 태그
- expires: 엔터티가 더 이상 유효하지 않아 원본을 다시 받아와야 하는 일시
- last-modified: 가장 최근 엔터티가 변경된 일시
